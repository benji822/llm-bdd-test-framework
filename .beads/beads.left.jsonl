{"id":"llm-bdd-test-framework-e06","content_hash":"a183688ddc1c3a23e16f2ea49b122d6ab27f918ea54607624e5fca689e03fc7c","title":"Stagehand-centric E2E Authoring (no clarifications)","description":"Design and implement a Stagehand-first pipeline replacing YAML/clarifications; deterministic CI; CLI now, UI later.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-08T18:06:28.984586695+08:00","updated_at":"2025-11-10T15:43:36.750621987+08:00","closed_at":"2025-11-10T15:43:36.750621987+08:00","source_repo":".","labels":["cli","e2e","no-clarifications","stagehand","ui"]}
{"id":"llm-bdd-test-framework-hoo","content_hash":"a183688ddc1c3a23e16f2ea49b122d6ab27f918ea54607624e5fca689e03fc7c","title":"Stagehand-centric E2E Authoring (no clarifications)","description":"Design and implement a Stagehand-first pipeline replacing YAML/clarifications; deterministic CI; CLI now, UI later.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-08T18:06:35.711584269+08:00","updated_at":"2025-11-10T16:12:07.588165148+08:00","closed_at":"2025-11-10T16:12:07.588165148+08:00","source_repo":".","labels":["cli","e2e","no-clarifications","stagehand","ui"],"comments":[{"id":1,"issue_id":"llm-bdd-test-framework-hoo","author":"benji822","text":"Scope decision: remove clarifications step entirely. Authoring flows use Stagehand sessions to derive Action Graph; compiler emits deterministic tests; CI never calls LLM.","created_at":"2025-11-08T10:08:35Z"}]}
{"id":"llm-bdd-test-framework-hoo.10","content_hash":"5f61e8f831ebf8ebbfd5b7b231d806986a65b0ae5377e06beb263496f5fc94cb","title":"CI gating and deterministic policy","description":"Block Stagehand in CI; ensure cached/compiled tests only; add pipeline checks.","notes":"Implemented the CI policy guard script (`tests/scripts/ci-policy.ts`) plus `ci:policy`/`pretest` hooks and documentation so CI jobs fail fast when Stagehand authoring mode, mock login, or missing compiled artifacts would violate the deterministic policy. Guard checks `tests/normalized/`, `tests/features/`, and `tests/steps/generated/` before allowing `yarn test` to run.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T18:07:40.233104704+08:00","updated_at":"2025-11-10T14:57:59.615128856+08:00","closed_at":"2025-11-10T14:57:59.615128856+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.10","depends_on_id":"llm-bdd-test-framework-hoo.9","type":"blocks","created_at":"2025-11-08T18:08:10.004879005+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.11","content_hash":"f1678d0cdfd99948ee54912bba2df1550a812c99634e66a9af50c67c07a5c7a6","title":"Minimal HTTP API for future UI","description":"Expose /sessions, /compile, /run; file-backed jobs; stream logs.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-08T18:07:41.453907929+08:00","updated_at":"2025-11-08T18:07:41.453907929+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.11","depends_on_id":"llm-bdd-test-framework-hoo.8","type":"blocks","created_at":"2025-11-08T18:08:15.256410462+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.12","content_hash":"7966620350034118e6eb6d9960fe9e8c5f8a893144bef438e46bdf1f020d60a5","title":"Replace legacy LLM pipeline; remove clarifications","description":"Remove clarifications/normalize steps; migrate docs and scripts; keep Playwright runner.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-08T18:07:42.660573696+08:00","updated_at":"2025-11-08T18:07:42.660573696+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.12","depends_on_id":"llm-bdd-test-framework-hoo.8","type":"blocks","created_at":"2025-11-08T18:08:16.630998188+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.12","depends_on_id":"llm-bdd-test-framework-hoo.6","type":"blocks","created_at":"2025-11-08T18:08:17.941619444+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.12","depends_on_id":"llm-bdd-test-framework-hoo.7","type":"blocks","created_at":"2025-11-08T18:08:19.134174686+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.13","content_hash":"4c2a37927a843f0164582dacefe92f0b10ca6c31e3e6604ef30188940c7d523b","title":"OpenRouter provider wiring (authoring only)","description":"Configure provider/model and keys; document costs; no CI dependency.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-08T18:07:43.976129039+08:00","updated_at":"2025-11-08T18:07:43.976129039+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"]}
{"id":"llm-bdd-test-framework-hoo.14","content_hash":"467fb8aed8d1917e6a3e75231cd5c6c945e6cd1fdb1fdeb58383c8fad84a7a9f","title":"Provenance ledger (.ndjson) + cost metrics","description":"Append per action/test: tokens, duration, cache hits, hashes; redact secrets.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-08T18:07:45.224200814+08:00","updated_at":"2025-11-08T18:07:45.224200814+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.14","depends_on_id":"llm-bdd-test-framework-hoo.8","type":"blocks","created_at":"2025-11-08T18:08:20.39139432+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.15","content_hash":"c0067a77d070a2839d2888426029b523624341507d495bea2d888a10e5f84a13","title":"Spike: record→compile→run a login flow","description":"Deliver end-to-end demo with deterministic CI replay and documented steps.","notes":"Outcome: E2E spike validated. Root cause of prior failures was sandboxed environment blocking local sockets (CODEX_SANDBOX_NETWORK_DISABLED=1), causing Chromium startup to abort. Workaround validated by running Playwright with network enabled (local sockets only). Evidence: 1) Smoke test passed. 2) Generated BDD login scenario passed with MOCK_LOGIN_APP=true.\n\nKey changes:\n- Added configurable launch toggles in `playwright.config.ts`:\n  - `PW_EXTRA_CHROME_ARGS`, `PW_IGNORE_NO_SANDBOX`, `PW_CHROME_PATH`, `PW_CHANNEL`.\n- Confirmed mock login app wiring via `tests/fixtures/stagehand-bdd.js` works.\n- Verified generated artifacts run: `tests/features/compiled/...authenticate-with-valid-credentials.feature` + matching steps.\n\nHow to run locally (non-sandbox):\n- `MOCK_LOGIN_APP=true yarn test` (uses bundled Chromium)\n- If needed: `PW_CHROME_PATH=/path/to/chrome MOCK_LOGIN_APP=true yarn test`\n- If distro supports SUID sandbox: `PW_IGNORE_NO_SANDBOX=true MOCK_LOGIN_APP=true yarn test`\n\nCI note:\n- Keep Stagehand/LLM off in CI; run compiled tests only. In strict sandboxes without sockets, use a compile-only job or run browser tests on a runner where local sockets are allowed.\n\nAcceptance (met): record→compile→run demo passes headless and is documented; deterministic replay uses mock app. ","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-08T18:07:46.553185799+08:00","updated_at":"2025-11-10T10:14:41.279571053+08:00","closed_at":"2025-11-10T10:14:41.279571053+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.15","depends_on_id":"llm-bdd-test-framework-hoo.4","type":"blocks","created_at":"2025-11-08T18:08:06.170729581+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.15","depends_on_id":"llm-bdd-test-framework-hoo.6","type":"blocks","created_at":"2025-11-08T18:08:07.46330086+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.15","depends_on_id":"llm-bdd-test-framework-hoo.7","type":"blocks","created_at":"2025-11-08T18:08:08.750239433+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.15","depends_on_id":"llm-bdd-test-framework-hoo.9","type":"blocks","created_at":"2025-11-08T18:08:21.656710052+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.3","content_hash":"f1acdad6536023826f2cc0a3e7f01523f52e6f4ed1271e41e227a42ba3b1dee5","title":"Test child (forced)","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-08T18:07:17.38995388+08:00","updated_at":"2025-11-08T18:07:17.38995388+08:00","source_repo":".","labels":["stagehand"]}
{"id":"llm-bdd-test-framework-hoo.4","content_hash":"afd757dea6bb1b36c2d49dae002c70080882297f5c414e22a5d30a795056a197","title":"Stagehand runtime wrapper over Playwright","description":"Wrap Playwright page/session to expose observe/act/extract with caching and policy guards.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-08T18:07:32.539323149+08:00","updated_at":"2025-11-08T18:34:15.490166029+08:00","closed_at":"2025-11-08T18:34:15.490166029+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"comments":[{"id":2,"issue_id":"llm-bdd-test-framework-hoo.4","author":"benji822","text":"Implemented authoring-mode guards; fixed Stagehand import/types; added Playwright decorator `withStagehand(page)` to attach observe/act/extract. Wrapper now enforces deterministic CI (blocks live LLM calls when `authoringMode=false` in CI) and caches results via `StagehandCache`.","created_at":"2025-11-08T10:25:12Z"},{"id":3,"issue_id":"llm-bdd-test-framework-hoo.4","author":"benji822","text":"Unit-tested Stagehand wrapper and CI policy guards. Summary:\\n\\n- Added authoring guards in observe/act/extract; blocks uncached calls in CI unless authoringMode=true.\\n- Fixed import/types to use Stagehand v3 directly.\\n- Exposed Playwright decorator: withStagehand(page).\\n- Wrote focused unit tests using local Stagehand mock; no browser/LLM network.\\n\\nFiles:\\n- tests/scripts/stagehand/wrapper.ts\\n- tests/scripts/stagehand/index.ts\\n- tests/scripts/stagehand/types.ts (type-only Playwright import)\\n- tests/mocks/node_modules/@browserbasehq/stagehand/index.js (mock)\\n- tests/mocks/register-stagehand-mock.js (runtime hook)\\n- tests/unit/stagehand-wrapper.test.ts (unit tests)\\n- tsconfig.unit.json (unit build config)\\n\\nHow to run locally:\\n- PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1 npm ci\\n- ./node_modules/.bin/tsc -p tsconfig.unit.json\\n- NODE_PATH=tests/mocks/node_modules:node_modules node --require ./tests/mocks/register-stagehand-mock.js dist-unit/unit/stagehand-wrapper.test.js\\n\\nAll tests passed on Nov 8, 2025.","created_at":"2025-11-08T10:34:00Z"}]}
{"id":"llm-bdd-test-framework-hoo.5","content_hash":"17d20b18c639260e6c692fb3f8fb709025396034dfe4de379839583ded1bdf17","title":"Define Action Graph schema + persistence","description":"Design typed nodes, I/O format, and write/read to artifacts/graph/*.json with versioning.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-08T18:07:33.793102035+08:00","updated_at":"2025-11-09T15:49:30.334089053+08:00","closed_at":"2025-11-09T15:49:30.334089053+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"comments":[{"id":4,"issue_id":"llm-bdd-test-framework-hoo.5","author":"benji822","text":"2025-11-09 code review findings:\n- Deleted tests/__tests__ regression suites → no coverage for normalize/collect/questions/etc.\n- GraphPersistence indexes graphs only by specId; any second scenario overwrites read() results.\n- yamlToActionGraph leaves every node type as act, drops testData, disconnects background nodes, and infers authorship via llmProvider=='cli'.\n- Schema $id points at cazino-frontend.com which we do not own.","created_at":"2025-11-09T07:21:03Z"},{"id":5,"issue_id":"llm-bdd-test-framework-hoo.5","author":"benji822","text":"Implemented action-graph fixes: restored regression suites, expanded builder to capture background sequencing + testData + authorship, and renamed persistence files per spec+scenario with new schema coverage. tsc + unit suites now pass.","created_at":"2025-11-09T07:49:22Z"}]}
{"id":"llm-bdd-test-framework-hoo.6","content_hash":"68eebed5ad4f87cdd08b173c5a6a06f3775af5a8baa6a146e504107e78b68e70","title":"Compiler: Action Graph → Gherkin + step defs","description":"Generate .feature and deterministic Playwright steps; no Stagehand in runtime.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-08T18:07:35.174339311+08:00","updated_at":"2025-11-09T16:29:09.37088241+08:00","closed_at":"2025-11-09T16:29:09.37088241+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.6","depends_on_id":"llm-bdd-test-framework-hoo.5","type":"blocks","created_at":"2025-11-08T18:08:05.034595294+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.7","content_hash":"be0e5f54523b8c0f6efe12a2465101781e64bc2fec5f761c9d2c813a0d51c211","title":"Selector registry + drift validator","description":"Single source of selectors with verification and suggested updates; artifacts/selectors/registry.json.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-08T18:07:36.40883233+08:00","updated_at":"2025-11-09T16:58:54.739778534+08:00","closed_at":"2025-11-09T16:58:54.739778534+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"]}
{"id":"llm-bdd-test-framework-hoo.8","content_hash":"d7be5d79080b7d6e7f73de13d4a287c6e4822dffc061465df698fd99cd9c2126","title":"Umbrella CLI 'bdd' (init, record, compile, run, verify)","description":"Single entrypoint mapping to services; friendly output and non-zero exit codes.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-08T18:07:37.697880824+08:00","updated_at":"2025-11-10T17:11:55.421735371+08:00","closed_at":"2025-11-10T17:11:55.421735371+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"dependencies":[{"issue_id":"llm-bdd-test-framework-hoo.8","depends_on_id":"llm-bdd-test-framework-hoo.4","type":"blocks","created_at":"2025-11-08T18:08:11.372963097+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.8","depends_on_id":"llm-bdd-test-framework-hoo.6","type":"blocks","created_at":"2025-11-08T18:08:12.688051417+08:00","created_by":"benji822"},{"issue_id":"llm-bdd-test-framework-hoo.8","depends_on_id":"llm-bdd-test-framework-hoo.7","type":"blocks","created_at":"2025-11-08T18:08:14.039221834+08:00","created_by":"benji822"}]}
{"id":"llm-bdd-test-framework-hoo.9","content_hash":"11f94d36a4cb1d5d8310befb6732f7941b1290ae985f61a0a4ec18a20f44e355","title":"Stagehand cache + authoring/CI policy toggles","description":"Enable STAGEHAND_CACHE_DIR and AUTHORING_MODE env flags; enforce CI LLM-off.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T18:07:38.940333615+08:00","updated_at":"2025-11-09T16:08:56.941590022+08:00","closed_at":"2025-11-09T16:08:56.941590022+08:00","source_repo":".","labels":["cli","deterministic","e2e","no-clarifications","stagehand","ui"],"comments":[{"id":6,"issue_id":"llm-bdd-test-framework-hoo.9","author":"benji822","text":"Wired StagehandWrapper defaults to STAGEHAND_CACHE_DIR/AUTHORING_MODE, tightened CI guard messaging, extended tests, and documented the new env toggles.","created_at":"2025-11-09T08:08:35Z"}]}
